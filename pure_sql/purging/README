

Data retention execution

Purging of old data is currently done as a manual process. As soon as
we are sure about the outcomes this process should be converted into
an automatic one.

Steps to take before every production upgrade:

0. Look through the scripts and see if there are any new foreign key
constraits introduced. Edit scripts accordingly.

1. Execute purge_documents.sql:

   ./run_remote prod@prod.scrive.lan purge_documents.sql

2. Execute purge_files.sql:

   ./run_remote prod@prod.scrive.lan purge_files.sql | tee files_to_delete.txt

3. Execute purge_files_from_amazon.sh:

   bash purge_files_from_amazon.sh files_to_delete.txt
   bash purge_files_from_remote_amazon_account.sh

As this process is pretty dangerous at each step it is best to edit
the scripts evey time so that they first work in dry-run (rollback)
mode.
