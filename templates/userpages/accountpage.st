####
showUser =
<div id="tab-viewer">
  <form action="$linkaccount$" method="post" class="accountForm">
    <div class="tab-header">
    </div>
    <ul class="tabs">
        <li class="active"><a href="/account">$_HeadUserInfo()$</a></li>
        <li><a href="/account/security">$_HeadAccountSettings()$</a></li>
        $if(iscompanyadmin)$<li><a href="/account/companyaccounts">$_CompanyAccounts()$</a></li>$endif$
        <li><a href="/account/mailapi">$_HeadMailApi()$</a></li>
        <li><a href="/account/usagestats">$_HeadUsageStats()$</a></li>
    </ul>
    <div class="tab-container">
        <div class="tab-content account">
            <div $if(iscompanyaccount)$class="col"$endif$>
                <div class="account-header">
                    <h2>$fstname$ $sndname$</h2>
                    <!-- <a href="javascript:;">Ladda upp ny bild...</a> -->
                    <div class="image">
                        $if(userimagelink)$
                        <img src="$userimagelink$" height="68" width="58" />
                        $endif$
                    </div>
                </div>
                <div class="account-body">
                    <table>
                        <tr>
                            <td>$_firstname()$:</td>
                            <td><input type="text" name="fstname" value="$fstname$" autocomplete="off" /></td>
                        </tr>
                        <tr>
                            <td>$_lastname()$:</td>
                            <td><input type="text" name="sndname" value="$sndname$" autocomplete="off" /></td>
                        </tr>
                        <tr>
                            <td>$_personnumber()$:</td>
                            <td><input type="text" name="personalnumber" value="$personalnumber$" autocomplete="off" /></td>
                        </tr>
                        <tr>
                            <td>$_email()$:</td>
                            <td><input type="email" name="email" value="$email$" autocomplete="off" disabled=""/></td>
                        </tr>
                        <tr>
                            <td>$_phone()$:</td>
                            <td><input type="text" name="phone" value="$phone$" autocomplete="off" /></td>
                        </tr>
                        <tr>
                            <td>$_companyposition()$:</td>
                            <td><input type="text" name="companyposition" value="$companyposition$" autocomplete="off" /></td>
                        </tr>
                    </table>
                </div>
            </div>
            $if(iscompanyaccount)$
            <div class="col">
                <div class="account-header">
                    <h2>$companyname$</h2>
                    <!--<a href="javascript:;">Ladda upp ny logotyp...</a> -->
                    <div class="image">
                        $if(companyimagelink)$
                        <img src="$companyimagelink$" height="68" width="58" />
                        $endif$
                    </div>
                </div>
                <div class="account-body">
                    <table>
                        <tr>
                            <td>$_company()$:</td>
                            <td><input type="text" name="companyname" value="$companyname$" autocomplete="off" $if(!iscompanyadmin)$disabled="disabled"$endif$/></td>
                        </tr>
                        <tr>
                            <td>$_orgnumber()$:</td>
                            <td><input type="text" name="companynumber" value="$companynumber$" autocomplete="off" $if(!iscompanyadmin)$disabled="disabled"$endif$ /></td>
                        </tr>
                        <tr>
                            <td>$_address()$:</td>
                            <td><input type="text" name="companyaddress" value="$address$" autocomplete="off"  $if(!iscompanyadmin)$disabled="disabled"$endif$/></td>
                        </tr>
                        <tr>
                            <td>$_zip()$:</td>
                            <td><input type="email" name="companyzip" value="$zip$" autocomplete="off"  $if(!iscompanyadmin)$disabled="disabled"$endif$/></td>
                        </tr>
                        <tr>
                            <td>$_city()$:</td>
                            <td><input type="text" name="companycity" value="$city$" autocomplete="off"  $if(!iscompanyadmin)$disabled="disabled"$endif$/></td>
                        </tr>
                        <tr>
                            <td>$_country()$:</td>
                            <td><input type="text" name="companycountry" value="$country$" autocomplete="off"  $if(!iscompanyadmin)$disabled="disabled"$endif$/></td>
                        </tr>
                    </table>
                </div>
            </div>
            $endif$
            <input type="submit" class="hidden" />
            <div class="account-footer">
                  $if(!iscompanyaccount)$
                  <a href="#" rel="#dialog-create-company" id="createcompany" class="btn-small green $if(createcompany)$loadbydefault$endif$">
                    <div class="left"></div>
                    <div class="label">
                        <p>$_createCompany()$</p>
                    </div>
                    <div class="right"></div>
                  </a>
                  $endif$
                  <a href="#" class="btn-small green submit">
                    <div class="left"></div>
                    <div class="label">
                        <p>$_SaveChanges()$</p>
                    </div>
                    <div class="right"></div>
                  </a>
            </div>
            <div class="clearfix"></div>

        </div>
    </div>
  </form>
  $modalCreateCompany()$
</div>
####
modalCreateCompany=
  <form method="post" name="form" action="$currentlink$" class="overlay redirectsubmitform" id="dialog-create-company" rel=".accountForm">
    <input type="hidden" name="createcompany" value="true" />
    <div class="modal-container">
      <div class="modal-header">
        <span class="modal-icon message"></span>
        <span class="modal-title">
          <h2>$_createCompany()$</h2>
        </span>
        <a class="modal-close close"> </a>
      </div>
      <div class="modal-body">
        <div class="modal-content">
          <div>
            <p>
            $_createCompanyExplanation()$
            </p>
            <p>
            $_createCompanyFormPreamble()$
            </p>
          </div>
          <div class="account-body">
            <table>
              <tr>
                  <td>$_company()$:</td>
                  <td><input type="text" name="companyname" value="$companyname$" autocomplete="off" /></td>
              </tr>
              <tr>
                  <td>$_orgnumber()$:</td>
                  <td><input type="text" name="companynumber" value="$companynumber$" autocomplete="off" /></td>
              </tr>
              <tr>
                  <td>$_address()$:</td>
                  <td><input type="text" name="companyaddress" value="$address$" autocomplete="off" /></td>
              </tr>
              <tr>
                  <td>$_zip()$:</td>
                  <td><input type="email" name="companyzip" value="$zip$" autocomplete="off" /></td>
              </tr>
              <tr>
                  <td>$_city()$:</td>
                  <td><input type="text" name="companycity" value="$city$" autocomplete="off" /></td>
              </tr>
              <tr>
                  <td>$_country()$:</td>
                  <td><input type="text" name="companycountry" value="$country$" autocomplete="off" /></td>
              </tr>
            </table>
          </div>
        </div>
        <input type="submit" class="hidden" />
      </div>
      <div class="modal-footer">
        <a class="cancel close float-left" style="height:40px;">
          <div class="label">$_cancel()$</div>
        </a>
        <a class="btn-small green float-right submit" href="#">
          <div class="left"></div>
          <div class="label"><p>$_createCompany()$</p></div>
          <div class="right"></div>
        </a>
      </div>
    </div>
  </form>
<script>
  jQuery(function() {
    var changeEmailRequestButton = Button.init({
    color: "green",
    size: "tiny",
    text: "$_changeEmailRequestButtonText()$",
    onClick: function() {
        var body = jQuery("<div>");
        var p = jQuery("<p>").text("$_changeEmailRequestExplanation()$");
        body.append(p);
        var table = jQuery("<table/>");

        var tr1 = jQuery("<tr/>").append(jQuery("<td/>").text("$_newemail()$:"));
        var newemail = jQuery("<input type='text' name='newemail' autocomplete='off' />");
        tr1.append(jQuery("<td/>").append(newemail));
        table.append(tr1);

        var tr2 = jQuery("<tr/>").append(jQuery("<td/>").text("$_newemailagain()$:"));
        var newemailagain = jQuery("<input type='text' name='newemailagain' autocomplete='off' />");
        tr2.append(jQuery("<td/>").append(newemailagain));
        table.append(tr2);

        body.append(table);


        Confirmation.popup({
          onAccept: function() {
                      new Submit({
                        method: "POST",
                        changeemail: "true",
                        newemail: newemail.val(),
                        newemailagain: newemailagain.val()
                        }).send();
                      },
          title: "$_changeEmailRequestTitle()$",
          acceptButtonText: "$_changeEmailRequestAcceptText()$",
          content: body
        });
      }
    });

    jQuery('[name="email"]').parent().append(changeEmailRequestButton.input());

    var addCompanyAccountButton = Button.init({
    color: "green",
    size: "small",
    text: "$_newCompanyAccountButtonText()$",
    onClick: function() {
        var body = jQuery("<div class='account-body'>");
        var firstp = jQuery("<p>").text("$_createCompanyExplanation()$");
        var secondp = jQuery("<p>").text("$_createCompanyFormPreamble()$");
        body.append(firstp);
        body.append(secondp);
        var table = jQuery("<table/>");

        var tr1 = jQuery("<tr/>").append(jQuery("<td/>").text("$_company()$:"));
        var companyname = jQuery("<input type='text' name='companyname' autocomplete='off' />");
        tr1.append(jQuery("<td/>").append(companyname));
        table.append(tr1);

        var tr2 = jQuery("<tr/>").append(jQuery("<td/>").text("$_orgnumber()$:"));
        var companynumber = jQuery("<input type='text' name='companynumber' autocomplete='off' />");
        tr2.append(jQuery("<td/>").append(companynumber));
        table.append(tr2);

        var tr5 = jQuery("<tr/>").append(jQuery("<td/>").text("$_address()$"));
        var companyaddress = jQuery("<input type='text' name='companyaddress' autocomplete='off' />");
        tr5.append(jQuery("<td/>").append(companyaddress));
        table.append(tr5);

        var tr6 = jQuery("<tr/>").append(jQuery("<td/>").text("$_zip()$"));
        var companyzip = jQuery("<input type='text' name='companyzip' autocomplete='off' />");
        tr6.append(jQuery("<td/>").append(companyzip));
        table.append(tr6);

        var tr7 = jQuery("<tr/>").append(jQuery("<td/>").text("$_city()$"));
        var companycity = jQuery("<input type='text' name='companycity' autocomplete='off' />");
        tr7.append(jQuery("<td/>").append(companycity));
        table.append(tr7);

        var tr8 = jQuery("<tr/>").append(jQuery("<td/>").text("$_country()$"));
        var companycountry = jQuery("<input type='text' name='companycountry' autocomplete='off' />");
        tr8.append(jQuery("<td/>").append(companycountry));
        table.append(tr8);

        body.append(table);


        Confirmation.popup({
          onAccept: function() {
            new Submit({
              method: "POST",
              createcompany: "true",
              companynumber: companynumber.val(),
              companyaddress: companyaddress.val(),
              companyzip: companyzip.val(),
              companycity: companycity.val(),
              companycountry: companycountry.val()
              }).send();
            },
          title: "$_createCompany()$",
          acceptButtonText: "$_createCompany()$",
          content: body
        });
      }
    });

    /** isn't used yet, because the server might decide to
        pop up this dialog in response to bad input validation.
       when validation happens on client we can start using **/
    var createcompany = jQuery("#createcompany");
    if (createcompany.length>0) {
      /** createcompany.append(addCompanyAccountButton.view.el); **/
    }
  });
</script>
#####
