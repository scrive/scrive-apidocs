# logrotate for production
# should be run early morning daily

/home/prod/kontrakcja/log/*.log {
  # rotate every day
  daily

  # Append the date to a rotated filename in a manner that works with snapshotlogs.sh 
  dateext

  # rotate one year before removing
  rotate 366

  # don't compress
  nocompress

  # run this script after rotation
  lastaction
    # restart the servers so that they use the new log files
    /usr/bin/supervisorctl restart prod
    /usr/bin/supervisorctl restart prod-mailer
    # run the snapshot
    bash /home/prod/kontrakcja/scripts/snapshotlogs.sh /home/prod/kontrakcja kontrakcja-logs /home/prod/kontrakcja
  endscript
}
