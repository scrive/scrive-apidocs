<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd"><html><head><meta content="text/html; charset=UTF-8" http-equiv="content-type"></meta><style type="text/css">a, html, body, div, p, em {  border: 0;  font-size: 100%;  margin: 0;  outline: 0;  padding: 0;  vertical-align: baseline;  color: #495259;}body {  background: #ffffff;  border: 0;  display: block;  font: 16px/1.3 "Source Sans Pro", "Helvetica Neue", Arial, Helvetica, sans-serif;  margin: 0 auto;  min-height: 480px;  outline: 0;  padding: 100px 0 100px 0;  position: relative;  width: 800px;}em {  font-style: italic;}.toc-1 {  font-weight: 600;}.toc-2 {  padding-left: 2em;}.toc-3 {  padding-left: 5em;  font-size: 14px;  margin-bottom: 12px;  display: none;}.toc-4 {  padding-left: 6em;}.toc-5 {  padding-left: 7em;}.toc-6 {  padding-left: 8em;}.cell-na {  background-color: #e6e6e6;}h1, h2, h3 {  display: block;  font-weight: normal;  letter-spacing: normal;  padding: 24px 0 0;}h1 {  font-size: 2.5em;  font-weight: bold;  line-height: 1em;  margin: 0 0 20px 0;}h2 {  font-size: 2.0em;  line-height: 1.1em;  margin: .6em 0 1em;}h3 {  font-size: 1.5em;  font-style: italic;  line-height: .8em;  margin: 0 0 1em 0;}h4 {  font-weight: normal;  font-style: italic;}p {  font-size: 1em;  line-height: 1.3em;  margin-bottom: 1em;  text-align: justify;}p#top {  padding-bottom: 30px;  margin-bottom: 1.2em;}p.center {  text-align: center;}div {  padding-bottom: 3em;}table {  border-collapse: collapse;  margin: 30px 0 40px 0;  width: 100%;}table td,th {  border: 1px solid black;  padding: 1em;}table p {  margin: 0;  text-align: left;}ol img {  vertical-align: middle;}</style></head><body><h1 id="h.xxeror0tjqw">Digital Signature Documentation</h1><p>Latest updated: Fri 06 Mar 2020 14:08:40 UTC</p><h2>Index</h2><p class="toc-1"><a href="#h.7qmdo9ls2o98">1. Purpose</a></p><p class="toc-1"><a href="#h.ucvrb2fx8z10">2. Overview</a></p><p class="toc-2"><a href="#h.t8h4gqxchvm9">2.1 Digital Signatures</a></p><p class="toc-2"><a href="#h.yfwn34o0pzv2">2.2 Cryptographic Hash Functions</a></p><p class="toc-2"><a href="#h.erp1zxs0nla4">2.3 Key-based digital signatures</a></p><p class="toc-2"><a href="#h.dteab0ufqslw">2.4 Keyless digital signatures for durability</a></p><p class="toc-2"><a href="#h.779g84c37vgt">2.5 Verifiable timestamps using keyless signatures</a></p><p class="toc-1"><a href="#h.vy7ba5oss5gg">3. How to Verify the Evidence Package</a></p><p class="toc-2"><a href="#h.ir3lkxntr98b">3.1 Extracting the Signature</a></p><p class="toc-2"><a href="#h.684wmy2onxzw">3.2 Parsing the Signature</a></p><p class="toc-2"><a href="#h.agplqev61lge">3.3 Checking the Document</a></p><p class="toc-2"><a href="#h.vhxm3sv9l38m">3.4 Checking the Signature</a></p><p class="toc-2"><a href="#h.apzbtrak16zd">3.5 Checking the Publication</a></p><p class="toc-2"><a href="#h.cstfjk8ssmw1">3.6 Conclusion</a></p><p class="toc-1"><a href="#h.3x290oulj2uw">4. Hash Functions</a></p><p class="toc-1"><a href="#h.trm43fewkpvo">5. Extracting the Signing Time</a></p><p class="toc-1"><a href="#h.t83r939295hw">6. Extending the TimeSignature</a></p><p class="toc-1"><a href="#h.s1v9zw847thw">7. References</a></p><h2 id="h.7qmdo9ls2o98">1. Purpose</h2><p>The purpose of the Digital Signature Documentation is to provide a method so that the integrity of the Evidence Package can be verified mathematically and independently of Scrive, Guardtime or any other third party, only relying on public information. </p><h2 id="h.ucvrb2fx8z10">2. Overview</h2><h3 id="h.t8h4gqxchvm9">2.1 Digital Signatures</h3><p>Digital signatures are used to make digital data tamper proof, so that it can be verified that the data has not been modified since the digital signature was created.</p><p>Digital signatures are designed in a way that there is a method for checking that the data that the signature is applied to is not modified, and that there is a method for checking that the signature has been issued in some trusted way.</p><h3 id="h.yfwn34o0pzv2">2.2 Cryptographic Hash Functions</h3><p>There is one mathematical concept that is pervasive in digital signing technologies: cryptographic hash functions. Such functions are used to straightforwardly compute a “hash value” of some fixed length (e.g. 256 bits) of some arbitrary amount of data, with the property that it is infeasible to reverse the function and get the data back from the hash value, but most importantly: it is infeasible to come up with any other piece of data that will compute to the same hash value.</p><p>These properties imply that it is sufficient to protect hash values of data instead of the data itself. The reason is that if we know that the protected hash value is unmodified and matches the hash value that we can compute of the data itself, then we know that it is infeasible that the data itself has been modified. For integrity purposes, hash values are essential condensations of the original data.</p><p>In addition to the cryptographic hash functions, many technologies for digital signatures are based on the use of keys.</p><h3 id="h.erp1zxs0nla4">2.3 Key-based digital signatures</h3><p>In key-based digital signatures, secret information (private keys) are used to create signatures by some trusted organisation. Each private key has a corresponding public key which is used for verifying the integrity of the digital signatures created with the private key. So to check a key-based digital signature, one needs to access the public key that corresponded to the secret key used to create the signature. In addition to verifying the signature using the public key, one has to verify that the public key comes from the trusted organisation that created the signature. This can be done using digital certificates as part of the public-key infrastructure.</p><p>Key-based digital signatures are problematic due to the durability requirements that come with protecting Evidence Packages. The private key must be kept secret by the trusted organisation. Should the key become public, the digital signatures that were issued using it can no longer be used to verify the integrity of the data. As a mitigation, the trusted organisation can limit the time that any one public/private key pair is used, and then erase the private key. Should a private key leak from the trusted organisation, only signatures created during the lifetime of the private key become worthless. However, more frequent renewal of keys mean that the organisation issuing digital signatures must provide more public keys for verification purposes. The main problem remains: how can one be sure that a private key was not leaked and used to forge digital signatures? The PAdES standard specifies a set of restrictions and extensions to the standards for PDF and ISO-32000-1 and -2. PAdES is described in the technical specification <a href="https://www.etsi.org/deliver/etsi_ts/102700_102799/10277806/01.01.01_60/ts_10277806v010101p.pdf">TS-102 778</a> that is published and maintained by the <a href="https://www.etsi.org/">European Telecommunication Standards Institute, ETSI</a>.</p><h3 id="h.dteab0ufqslw">2.4 Keyless digital signatures for durability</h3><p>Keyless digital signatures rely solely on the properties of cryptographic hash functions to protect data, without the use of secrets.</p><p>An extremely simple (but naive) method for creating a keyless digital signature is to compute the hash value of some data and then make that hash value public so that it can be used to verify that copies of the data have not been modified. It is important that the hash value is published so that that a verifier readily can find it and trust that the hash value is authentic, and that the publication is permanently accessible for the foreseeable future. A suitable method is to publish the hash value in a newspaper that is widely spread and archived throughout the world.</p><p>Although simple, the naive method described is not practical in that it requires one hash value to be published for each piece of data that needs a digital signature. To make keyless digital signatures practical one can combine hash values from multiple pieces of data by juxtaposing the hash values and computing new hash values of the result, as illustrated below:</p><p><img alt="Icon_02.png" src="data:image/png;base64,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"></img></p><p>By combining hash values in this way, one can choose to publish the combined hash value periodically, e.g. once a month. For verification to work, additional information is needed to ensure that a particular Evidence Package’s hash value leads to the hash value that is published in a newspaper (such a published hash value is called a publication code). Therefore, the digital signature contains information about what newspaper contains the publication code (currently, publication codes are printed in Financial Times), as well as intermediate hash values in the linked chain of hashes all the way to the publication code. For the middle Evidence Package in the diagram above, the digital signature would have information about where one can find the publication code c₆, as well as the intermediate hash values c₃, d₄, and d₅. From the Evidence Package’s computed hash value d₃, the intermediate hash values in the digital signature, and the combining cryptographic hash function H taking juxtaposed hash values, a verifier would compute the complete chain of hash values: c₄ = H(c₃,d₃), c₅ = H(c₄,d₄), c₆ = H(c₅, d₅). Having computed c₆, the verifier needs to check that it is equal to the newspaper’s publication code.</p><p>Since the digital signature must contain extra information about intermediate hash values that stem from other Evidence Packages leading to the publication code, one cannot immediately put the keyless digital signature into the Evidence Package upon its creation—one has to wait until the publication code is known. But since the parties involved in signing a document typically want access to the Evidence Package right away, Scrive E-sign provides the parties with an initial version of the Evidence Package with a temporary, keyless digital signature. Once the Evidence Package’s hash value has been part of the linked chain that leads to a publication code, Scrive E-sign produces a new Evidence Package with the permanent, keyless digital signature. Signatories that choose to store their Evidence Package in the archive service provided by Scrive E-sign can download the revised Evidence Package in the archive once it becomes available.</p><p>The devil in the details regarding the implementation of keyless digital signatures (e.g., in practice one would use trees of intermediate hash values instead of linked chains), but the fundamental principle is the same: data can be verified by computing a sequence of hash values and check against a value that is published in a trusted way.</p><h3 id="h.779g84c37vgt">2.5 Verifiable timestamps using keyless signatures</h3><p>The keyless signature not only provides a method for verifying the integrity of the Evidence Package, it also encodes the time down to the second when the signature was created. By construction, the time encoding is irrefutable and can be produced as part of the verification method of the keyless digital signature.</p><p>The following diagram gives a simplified version of how the time encoding works. Each publication code that goes into a newspaper is the root of the so called calendar tree, which is an ever-growing tree with one leaf node for each second since midnight, January 1st, 1970 in Coordinated Universal Time (UTC), a point in time we will denote T₀. (In the diagram, we have assumed that there is one evidence package providing the hash value for each leaf node, which is a simplification since we for each second may have zero or more than one evidence package for which we want a digital signature. In reality, the hash value of each leaf node in the calendar tree is constructed from an aggregation tree of hash values. We have also assumed a very small calendar tree, consisting of just four leaf nodes spanning a time of four seconds. A calendar tree for a whole month is of course much larger.)</p><p><img alt="N2.png" src="data:image/png;base64,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"></img></p><p>Now, suppose we want to verify the digital signature for the evidence package in the third row. The digital signature contains the path from the root down to the leaf, telling us if we should choose the upper route (encoded as a 0) or lower route (encoded as a 1) to get to the next level. The choices form a sequence which can be interpreted as a binary number, and for the path highlighted in yellow, this binary number is 10 which in decimal is the number 2. One can then conclude that this leaf was constructed at T₀ + 2, that is, 2 seconds after midnight, January 1st, 1970 (UTC).</p><p>(In reality, the time encoding is not done using T₀ as a start point, but instead by using the time when the publication code was created as an end point. Details can be found in appendix <a href="#h.trm43fewkpvo">Extracting the Signing Time</a>.)</p><p>The next section provides precise information about the digital signatures produced by Scrive E-sign and how they can be verified.</p><h2 id="h.vy7ba5oss5gg">3. How to Verify the Evidence Package</h2><p>The signed document (PDF file) that the Evidence Package (HTML attachments - that this Digital Signature Documentation is part of) is embedded into, has either been electronically sealed by Scrive using the Guardtime Keyless Signature technology or with a PAdES digital signature. This enables independent verification of the time when the document was signed and checking that it has not been modified since. The process consists of several steps outlined below. If the document is signed using PAdES the signature can be validated in Acrobat Reader.</p><h3 id="h.ir3lkxntr98b">3.1 Extracting the Signature</h3><p>The signature is embedded into the document following the standard PDF digital signature framework [<a href="#id.g4ayzllusv8r">PDF</a>, section 12.8]. A Guardtime signature has the value GTTS.TimeStamp in its Filter field.</p><p>A single PDF file can contain several revisions of a document [<a href="#id.g4ayzllusv8r">PDF</a>, section 7.5.6]. A Guardtime signature normally signs all revisions up to and including the one that contains it. In order to verify the document as it was signed, all subsequent updates have to be removed from the file.</p><p>More precisely, the signature protects the parts of the document specified by the ByteRange field of the signature. The two ranges must cover everything left after the previous step, except the Contents field of the signature.</p><p>The signature value is embedded in the Contents field in base 16 encoding. The value has to be stripped of trailing spaces and decoded [<a href="#id.49c0nxdudnjg">BASE</a>, section 8] for further processing.</p><h3 id="h.684wmy2onxzw">3.2 Parsing the Signature</h3><p>The result of the previous step has to be parsed as an ASN.1 data structure in BER encoding [<a href="#id.ur3yfdr7m8al">ASN</a>, <a href="#id.qkznv2d1prbo">DER</a>]. This must yield a ContentInfo structure [<a href="#id.udmmuia1b3dv">CMS</a>, section 3] that embeds a SignedData structure [<a href="#id.udmmuia1b3dv">CMS</a>, section 5] in the content field.</p><p>The contents of the encapContentInfo.eContent field of the SignedData structure have to be parsed as an ASN.1 data structure in DER encoding. This must yield a TSTInfo structure [<a href="#id.o9i76xxfmh3s">TSP</a>, section 2.4.2].</p><p>A Guardtime signature must have a single SignerInfo element in the signerInfos field of the SignedData structure and the object identifier 1.3.6.1.4.1.27868.4.1 in the signatureAlgorithm field of the SignerInfo structure.</p><p>The contents of the signature field of the SignerInfo structure have to be parsed as an ASN.1 data structure in DER encoding. This must yield a Guardtime-defined TimeSignature structure:</p><p>                          TimeSignature ::= SEQUENCE {</p><p>                            location HashChain,</p><p>                            history HashChain,</p><p>                            publishedData PublishedData,</p><p>                            pkSignature [0] SignatureInfo OPTIONAL,</p><p>                            pubReference [1] SET OF OCTET STRING OPTIONAL</p><p>                          }</p><p>                          PublishedData ::= SEQUENCE {</p><p>                            publicationIdentifier INTEGER,</p><p>                            publicationImprint DataImprint</p><p>                          }</p><p>Each of the HashChain fields is an ASN.1 OCTET STRING that contains a concatenation of a number of HashStep records. Each HashStep record in turn is a concatenation of a 1-byte hash algorithm code (appendix <a href="#h.3x290oulj2uw">Hash Functions</a>), a 1-byte direction indicator, a variable-length DataImprint field, and a 1-byte level number. The DataImprint field consists of a 1-byte hash algorithm code followed by the hash value (the number of bytes determined by the hash function). Note that all these are just concatenated together, not encoded as separate ASN.1 fields.</p><p>The DataImprint field in the PublishedData structure is an ASN.1 OCTET STRING that consists of a 1-byte hash algorithm code followed by the corresponding number of bytes of hash value (again, just concatenated).</p><p>The contents of the pkSignature and pubReference fields will not be used in the following and thus need not be parsed. However, presence of the pkSignature field indicates the hash chain contained in the history field is a temporary one not connected to a printed control publication. In such a case, the history and publishedData fields should be updated before proceeding (appendix <a href="#h.t83r939295hw">Extending the TimeSignature</a>).</p><h3 id="h.agplqev61lge">3.3 Checking the Document</h3><p>To check that the document matches the signature, it must be verified that the hash value of the signed document corresponds to the one embedded in the signature.</p><p>The concatenation of the sections of the original PDF file specified by the ByteRange field has to be hashed using the algorithm specified by the messageImprint.hashAlgorithm field of the TSTInfo structure. The result must be equal to the value of the messageImprint.hashedMessage field of the TSTInfo structure.</p><h3 id="h.vhxm3sv9l38m">3.4 Checking the Signature</h3><p>To check that the signature is internally consistent, it must be verified in several places that the hash value computed from one part of the signature corresponds to the one embedded in another part.</p><p>The DER-encoded representation of the TSTInfo structure (that is, the value of the encapContentInfo.eContent field of the SignedData structure) has to be hashed using the algorithm specified by the digestAlgorithm field of the SignerInfo structure. The result must be equal to the value of the message-digest attribute in the signedAttrs field of the SignerInfo structure.</p><p>The DER-encoded representation of the SignedAttributes structure has to be hashed using the algorithm specified by the digestAlgorithm field of the SignerInfo structure. The result will be the input data to the hash chain computation process described next. Note that the data to be hashed in this step is different from the representation of the signedAttrs field in the SignerInfo structure, as the latter is a tagged implicit set while the former is an explicit set [<a href="#id.udmmuia1b3dv">CMS</a>, section 5.4].</p><p>For each HashStep record in the location hash chain and then for each HashStep record in the history hash chain in the TimeSignature structure, in the order in which the records appear in the chains:</p><ol start="1"><li>compute x as the result of hashing the input data with the algorithm specified by the hash algorithm code (the first byte) in the record;</li><li>if the direction indicator (the second byte) in the record is 0:</li><li>compute y as the concatenation of the DataImprint field (bytes from the third up to but excluding the last), the hash algorithm code (the first byte), the value of x, and the level byte (the last byte);</li><li>if the direction indicator (the second byte) in the record is 1:</li><li>compute y as the concatenation of the hash algorithm code (the first byte), the value of x, the DataImprint field (bytes from the third up to but excluding the last), and the level byte (the last byte);</li><li>if the direction indicator (the second byte) is something else:</li><li>abort with an error &quot;invalid signature&quot;;</li><li>the value of y is the input for the next step.</li></ol><p>Finally, the value of y from the last step of the hash chain computation has to be hashed using the hash algorithm specified by the first byte of the publicationImprint field of the PublishedData structure. The result must be equal to the remaining bytes of the publicationImprint field.</p><h3 id="h.apzbtrak16zd">3.5 Checking the Publication</h3><p>To check that the signature matches the widely witnessed control publication, it must be verified that the contents of the PublishedData structure correspond to a printed publication acquired from a trusted source.</p><p>The publicationIdentifier field in the PublishedData structure contains the POSIX time [<a href="#id.k769p2s07xyo">POSIX</a>, section 4.15] value for the moment when the control publication was generated. A Guardtime control publication appears in the World Edition of the Financial Times 2–6 days after it is generated (depending on the publisher&#39;s schedules).</p><p>The PublishedData structure is formatted into human-comparable form as follows:</p><ol start="1"><li>the value of the publicationIdentifier field as a 64-bit integer (8 bytes in big-endian order) and the contents of the publicationImprint field are concatenated;</li><li>a CRC-32 checksum [<a href="#id.33dtclsfzzg">CRC</a>, section 8.1.1.6.2] is computed on the result of the previous step and appended to it;</li><li>the result of the previous step is encoded in base 32 [<a href="#id.49c0nxdudnjg">BASE</a>, section 6];</li><li>the result of the previous step may be broken into groups of 6 or 8 characters by dashes.</li></ol><p>The result must be equal to the control publication that appears in the newspaper (ignoring possible differences in the optional character grouping).</p><h3 id="h.cstfjk8ssmw1">3.6 Conclusion</h3><p>Since in the whole computation starts from the contents of the PDF file and through a series applications of one-way functions ends up at a value that was known to exist at some well-established time in the past (the time when the newspaper was printed), this proves that the file in question existed before that time in the same form as it is currently.</p><p>The preceding statement relies only on the hash functions being one-way and assumes absolutely nothing about the Guardtime technology. Adding information about how the hash chains are constructed (which is seen by all Guardtime clients while it happens and can thus also be considered quite widely witnessed) makes it possible to extract the signing time with much better precision (appendix <a href="#h.trm43fewkpvo">Extracting the Signing Time</a>).</p><h2 id="h.3x290oulj2uw">4. Hash Functions</h2><p>The following table lists the hash functions that may be used in hash chains in Guardtime keyless signatures, along with their identifiers and hash value sizes.</p><a id="t.f32c806c8fdb1712e004870bfd1a1277afaf6790"></a><a id="t.0"></a><table><tbody><tr><th colspan="1" rowspan="1"><p>Algorithm Name</p></th><th colspan="1" rowspan="1"><p>Guardtime ID</p></th><th colspan="1" rowspan="1"><p>Hash Value Size</p></th><th colspan="1" rowspan="1"><p>Algorithm Specification</p></th></tr><tr><td colspan="1" rowspan="1"><p>SHA-1</p></td><td colspan="1" rowspan="1"><p>0</p></td><td colspan="1" rowspan="1"><p>20</p></td><td colspan="1" rowspan="1"><p><a href="#id.ro3tloa0c7vg">SHA</a>, section 6.1</p></td></tr><tr><td colspan="1" rowspan="1"><p>SHA-224</p></td><td colspan="1" rowspan="1"><p>3</p></td><td colspan="1" rowspan="1"><p>28</p></td><td colspan="1" rowspan="1"><p><a href="#id.ro3tloa0c7vg">SHA</a>, section 6.3</p></td></tr><tr><td colspan="1" rowspan="1"><p>SHA-256</p></td><td colspan="1" rowspan="1"><p>1</p></td><td colspan="1" rowspan="1"><p>32</p></td><td colspan="1" rowspan="1"><p><a href="#id.ro3tloa0c7vg">SHA</a>, section 6.2</p></td></tr><tr><td colspan="1" rowspan="1"><p>SHA-384</p></td><td colspan="1" rowspan="1"><p>4</p></td><td colspan="1" rowspan="1"><p>48</p></td><td colspan="1" rowspan="1"><p><a href="#id.ro3tloa0c7vg">SHA</a>, section 6.5</p></td></tr><tr><td colspan="1" rowspan="1"><p>SHA-512</p></td><td colspan="1" rowspan="1"><p>5</p></td><td colspan="1" rowspan="1"><p>64</p></td><td colspan="1" rowspan="1"><p><a href="#id.ro3tloa0c7vg">SHA</a>, section 6.4</p></td></tr><tr><td colspan="1" rowspan="1"><p>RIPEMD-160</p></td><td colspan="1" rowspan="1"><p>2</p></td><td colspan="1" rowspan="1"><p>20</p></td><td colspan="1" rowspan="1"><p><a href="#id.w347d3nw3vut">RIPE</a>, section 7</p></td></tr></tbody></table><h2 id="h.trm43fewkpvo">5. Extracting the Signing Time</h2><p>The time when a datum was signed with a Guardtime keyless signature can be extacted from the history and the publicationIdentifier fields of the TimeSignature structure (section <a href="#h.684wmy2onxzw">Parsing the Signature</a>). The process is as follows:</p><ol start="1"><li>set h to 0 and p to the value of the publicationIdentifier field;</li><li>for each HashStep record in the history hash chain, in the reverse of the order in which the records appear in the chain:</li></ol><ul><li>if p is 0: abort with an error &quot;invalid signature&quot;;</li><li>set x to the highest power of 2 that does not exceed p;</li><li>if the direction indicator (the second byte) in the record is 0: set h to h+x and p to p-x;</li><li>if the direction indicator (the second byte) in the record is 1: set p to x-1;</li><li>if the direction indicator (the second byte) is something else: abort with an error &quot;invalid signature&quot;;</li></ul><ol start="3"><li>if p is not 0: abort with an error &quot;invalid signature&quot;;</li></ol><p>The final value of h is the POSIX time [<a href="#id.k769p2s07xyo">POSIX</a>, section 4.15] value for the moment when the datum was signed.</p><h2 id="h.t83r939295hw">6. Extending the TimeSignature</h2><p>For each Guardtime signature and any control publication generated after the signature was issued, a hash chain can be created that connects the signature to the control publication and thus also to the printed medium in which the publication appeared. This process is called extending the signature.</p><p>The preferred way to do this is to access an online verification service using a tool obtained from either Scrive or Guardtime. This can also be done independently using the calendar database acquired either from Guardtime or, in case Guardtime has ceased the service, from the Estonian Technical Surveillance Authority, to which Guardtime is obligated to deposit the database before exiting the business.</p><p>The Guardtime calendar database consists of one hash value per second, indexed by integral POSIX time [<a href="#id.k769p2s07xyo">POSIX</a>, section 4.15] values (red nodes and black numbers on the figure below). Each of these hash values aggregates all signing requests that the Guardtime service processed during the corresponding 1-second time interval.</p><p>The aggregate hash values are connected into binary trees by hashing them together in pairs in left to right order, then hashing the first level pairs together again, and so on until a set of complete binary trees is obtained (blue arrows and nodes on the figure). For generating the control publication, the roots of the binary trees are hashed into a chain in right to left order (purple arrows and nodes), and the value from the last node of the chain is extracted for generating the control publication (golden arrow).</p><p>More precisely, each node on the figure is a DataImprint structure (section <a href="#h.684wmy2onxzw">Parsing the Signature</a>). On each step, the DataImprint from the left child node, the DataImprint from the right child node, and a single byte with the value of 255 are concatenated together, hashed, and the result is obtained as a DataImprint consisting of the concatenation of the 1-byte hash algorithm code (appendix <a href="#h.3x290oulj2uw">Hash Functions</a>) and the hash value.</p><p><img alt="3bis.png" src="data:image/png;base64,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"></img></p><p>For manageability, the database is split into several files (separated by dashed black lines on the figure). For the files to be usable without access to preceding ones, each file starting from some time value t also contains the root values from the binary trees corresponding to the state of the database on time t-1 (dashed blue arrows between the first and second file on the figure).</p><p>To construct the hash chain linking a given signature to a given publication, the following steps have to be performed:</p><ol start="1"><li>The signing time has to be extracted from the history and publishedData fields currently in the signature (appendix <a href="#h.trm43fewkpvo">Extracting the Signing Time</a>);</li><li>The calendar database files covering the full interval from the signing time to the time when the publication was generated have to be obtained (format and naming of the files described later in this section);</li><li>The hash-linked structure corresponding to the time when the publication was generated has to be reconstructed (as described earlier in this section);</li><li>The unique hash chain connecting the leaf entry corresponding to the signing time to the root entry corresponding to the control publication (dotted arrows on the figure above) has to be extracted;</li><li>The TimeSignature structure (section <a href="#h.684wmy2onxzw">Parsing the Signature</a>) has to be updated with new values:</li></ol><ul><li>The history field is set to the concatenation of HashStep records describing the steps in the hash chain; each HashStep record is constructed as the concatenation of the 1-byte hash algorithm code from the DataImprint in the current node, the 1-byte direction indicator (0 if the sibling node is to the right in the tree, 1 if the sibling is to the left), the DataImprint from the sibling node, and a single byte with the value of 255;</li><li>The publicationIdentifier field is set to the POSIX time value for the moment when the control publication was generated;</li><li>The publicationImprint field is set to the DataImprint value in the root entry corresponding to the control publication.</li></ul><p>Each calendar database file consists of a fixed header, a set of root node records, a sequence of calendar node records, and a checksum record. In the following, many values are given in hexadecimal, with the 0x prefix prepended.</p><p>The header consists of 12 fields totaling 65 bytes:</p><ol start="1"><li>8-byte sequence: file format identifier; must be 0x47, 0x54, 0x49, 0x4d, 0x45, 0x48, 0x44, and 0x42 (ASCII representation of &#39;GTIMEHDB&#39;);</li><li>4-byte integer: endian-ness indicator; fixed value 0x01020304; all other 32-bit integers in the file will be in the same byte order;</li><li>4-byte integer: version number; must be 0x00000001 (in file byte order);</li><li>8-byte integer: endian-ness indicator; fixed value 0x0102030405060708; all other 64-bit integers in the file will be in the same byte order;</li><li>8-byte integer: file creation time as POSIX time;</li><li>8-byte integer: first calendar record index; the POSIX time value for the first node in the calendar node section of the file;</li><li>4-byte integer: first calendar record offset; the offset of the start of the calendar node section within the file;</li><li>4-byte integer: calendar record length; the length of each record in the calendar node section of the file;</li><li>1 byte: calendar hash algorithm; the 1-byte hash algorithm code (appendix <a href="#h.3x290oulj2uw">Hash Functions</a>) for the hash function used by all calendar nodes in this file (they all must use the same algorithm);</li><li>1 byte: flags; must be 0x01;</li><li>14 bytes: reserved for future; all bytes must be 0x00;</li><li>1 byte: CRC8 checksum of all preceding bytes in the header record; this is intended as a short-term protection against accidental errors while the file is being created; checking this may be omitted as the checksum record at the end of the file gives much stronger protection.</li></ol><p>The root node section spans the space from the end of the header to the beginning of the calendar node section. It consists of a sequence of root node records followed by a 1-byte CRC8 checksum of all preceding bytes in the section. Each root node record consists of 4 fields:</p><ol start="1"><li>4-byte integer: record length; the number of bytes to follow in this record (excluding the length field itself);</li><li>8-byte integer: record index; the POSIX time value for the last calendar node in the complete binary tree whose root this node is;</li><li>1 byte: the 1-byte hash algorithm code for the hash function used in this node;</li><li>variable-length sequence: the hash value in this node (the length is determined by the hash function used; it may also be computed by subtracting 9 from the value of the record length field).</li></ol><p>Note that the concatenation of the two last fields in each record yields the DataImprint value for the corresponding node.</p><p>The calendar node section spans the space from the end of the root node section to almost the end of the file; it is followed only by a checksum record that has the same size and format as a calendar node record. It consists of a sequence of calendar node records (and no section checksum). Each calendar node record consists of 3 fields:</p><ol start="1"><li>4-byte integer: record index offset; this value is to be added to the first calendar record index field from the file header to obtain the POSIX time value for this node;</li><li>variable-length sequence: the hash value in this node (the length is determined by the hash function used which is specified by the calendar hash algorithm field in the file header; it may also be obtained by subtracting 5 from the calendar record length field in the file header);</li><li>1 byte: CRC8 checksum of all preceding bytes in the record.</li></ol><p>Again, note that the concatenation of the calendar hash algorithm field from the file header and the hash value field from the record yields the DataImprint value for the corresponding node.</p><p>The last record in the file is the cryptographic checksum of the whole file:</p><ol start="1"><li>4-byte integer: fixed value 0xffffffff;</li><li>variable-length sequence: the hash value computed by hashing all data preceding the checksum record in the file using the hash function specified in the calendar hash algorithm field in the file header (the length is the same as for the calendar node records);</li><li>1 byte: CRC8 checksum of all preceding bytes in the record.</li></ol><p>The calendar database files are named following the pattern</p><p>    hashdb-tttttttttttttttt-yyyy-mm-dd-hhmmss.bin</p><p>where the fields have the following meaning:</p><ol start="1"><li>filename prefix, always hashdb;</li><li>POSIX time value for the first calendar node in the file; 16-digit lower-case hexadecimal number with leading zeroes preserved (but no 0x prefix);</li><li>year, month, and day of the file creation time; month and day are 2-digit decimal numbers with the leading zeroes preserved;</li><li>hour, minute, and second of the file creation time (in UTC); each is 2-digit decimal number with the leading zero preserved;</li><li>filename suffix, always bin.</li></ol><h2 id="h.s1v9zw847thw">7. References</h2><a id="id.g4ayzllusv8r"></a><p>[PDF]</p><p>Document management — Portable document format — Part 1: PDF 1.7</p><p>ISO 32000-1:2008, International Organization for Standardization, 2008</p><a id="id.o9i76xxfmh3s"></a><p>[TSP]</p><p>Internet X.509 Public Key Infrastructure: Time-Stamp Protocol (TSP)</p><p>RFC 3161, Internet Engineering Task Force, 2001</p><a id="id.udmmuia1b3dv"></a><p>[CMS]</p><p>Cryptographic Message Syntax</p><p>RFC 2630, Internet Engineering Task Force, 1999</p><a id="id.ur3yfdr7m8al"></a><p>[ASN]</p><p>Information technology — Abstract Syntax Notation One (ASN.1): Specification of basic notation</p><p>ITU-T X.680, International Telecommunication Union, 2002</p><a id="id.qkznv2d1prbo"></a><p>[DER]</p><p>Information technology — ASN.1 encoding rules: Specification of Basic Encoding Rules (BER), Canonical Encoding Rules (CER) and Distinguished Encoding Rules (DER)</p><p>ITU-T X.690, International Telecommunication Union, 2002</p><a id="id.49c0nxdudnjg"></a><p>[BASE]</p><p>The Base16, Base32, and Base64 Data Encodings</p><p>RFC 4648, Internet Engineering Task Force, 2006</p><a id="id.ro3tloa0c7vg"></a><p>[SHA]</p><p>Secure Hash Standard (SHS)</p><p>FIPS 180-4, National Institute of Standards and Technology, 2012</p><a id="id.w347d3nw3vut"></a><p>[RIPE]</p><p>Information technology — Security techniques — Hash-functions — Part 3: Dedicated hash-functions</p><p>ISO/IEC 10118-3:2004, International Organization for Standardization, 2004</p><a id="id.k769p2s07xyo"></a><p>[POSIX]</p><p>Standard for Information Technology — Portable Operating System Interface (POSIX)</p><p>IEEE 1003.1-2008, The Institute of Electrical &amp; Electronics Engineers, 2008</p><a id="id.33dtclsfzzg"></a><p>[CRC]</p><p>Error-correcting procedures for DCEs using asynchronous-to-synchronous conversion</p><p>ITU-T V.42, International Telecommunication Union, 2002</p></body></html>